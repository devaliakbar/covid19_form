var _createClass=function(){function i(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,n,e){return n&&i(t.prototype,n),e&&i(t,e),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}function shouldUseNative(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var n={},e=0;e<10;e++)n["_"+String.fromCharCode(e)]=e;if("0123456789"!==Object.getOwnPropertyNames(n).map(function(t){return n[t]}).join(""))return!1;var i={};return"abcdefghijklmnopqrst".split("").forEach(function(t){i[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},i)).join("")}catch(t){return!1}}var objectAssign=shouldUseNative()?Object.assign:function(t,n){for(var e,i,a=toObject(t),r=1;r<arguments.length;r++){for(var s in e=Object(arguments[r]))hasOwnProperty.call(e,s)&&(a[s]=e[s]);if(getOwnPropertySymbols){i=getOwnPropertySymbols(e);for(var o=0;o<i.length;o++)propIsEnumerable.call(e,i[o])&&(a[i[o]]=e[i[o]])}}return a};function uniqueId(t){return t?"_"+Math.random().toString(36).substr(2,t):"_"+Math.random().toString(36).substr(2,9)}function isArray(t){return Array.isArray(t)}function isObject(t){return"object"===(void 0===t?"undefined":_typeof(t))}function isEmpty(t){return isArray(t)?0===t.length:!!isObject(t)&&0===Object.keys(t).length}function isFunction(t){return t instanceof Function}function isDate(t){return t instanceof Date}function assign(t,n){return objectAssign(t,n)}function clone(t){return Array.isArray(t)?t.slice(0):JSON.parse(JSON.stringify(t))}function reverse(t){return isArray(t)?t.reverse():t}function map(t,n){if(isArray(t)&&t.length){for(var e=0;e<t.length;e++)t[e]=n(t[e],e);return t}return[]}function filter(t,n){var e=[];if(isArray(t)&&t.length){for(var i=0;i<t.length;i++)n(t[i],i)&&e.push(t[i]);return e}return e}function forIn(t,n){var e=[];if(isObject(t))for(var i=Object.keys(t),a=0;a<i.length;a++)e.push(n(t[i[a]],i[a],a));return e}var sortDirection={ASC:"asc",DESC:"desc"},defaultConfig={element:"",data:[],columns:[],sorting:!0,pagination:!0,paginationContainer:null,paginationLength:5,showPaginationLabel:!0,processHtml:null,columnsHtml:null,searchField:null,responsive:[],dateParsing:!0,generateUniqueIds:!0,sortingIcons:{asc:"<span>▼</span>",dec:"<span>▲</span>"},nextText:"<span>Next</span>",prevText:"<span>Prev</span>",events:{onInit:null,onUpdate:null,onDistroy:null}},TableSortable=function(){function n(t){_classCallCheck(this,n),this.config=$.extend(defaultConfig,t),this.sortingKey=null,this.sortDirection=null,this.currentPage=0,this.rowsOnPage=5,this.isUpdating=!1,this.prevScreenWidth=window.innerWidth,this.isPaginationGenerated=!1,this.isDistroyed=!1,this.table=this.constructTableObject(),this.getOriginalData(),this.getColumns(),this.getPagesOffset(this.currentPage),this.constructControlObject(),this.generatePagination(),this.constructTableCell(),this.handleSearchField(),this.onTableResize(),this.afterInit()}return _createClass(n,[{key:"getOriginalData",value:function(){var t=this.config,n=t.data,e=t.columns,i=t.generateUniqueIds;i&&(n=map(n,"number"===i?function(t,n){return t._gsUniqueId=n,t}:function(t){return t._gsUniqueId=uniqueId(),t})),this.config.data=n,this.config.originalData=map(n,clone),this.config.originalColumns=clone(e),this.config.originalPaginationLength=Math.abs(this.config.paginationLength),this.config.originalPagination=clone(this.config.pagination),this.config.paginationLength=Math.abs(this.config.paginationLength),this.config.originalShowPaginationLabel=clone(this.config.showPaginationLabel)}},{key:"getConfig",value:function(){return this.config}},{key:"getData",value:function(){return this.config.originalData}},{key:"getPagesOffset",value:function(t){var n=this.config,e=n.data,i=n.pagination;if(e.length)return i?(i&&!isNaN(parseInt(i,10))&&(this.rowsOnPage=Math.abs(i)),this.currentPage=t,this.leftBase=this.currentPage*this.rowsOnPage,this.rightBase=Math.min(this.leftBase+this.rowsOnPage,e.length),this.currentPage):(this.leftBase=this.currentPage,void(this.rightBase=e.length))}},{key:"getColumns",value:function(){var t=this.config,n=t.columns,e=t.responsive,i=t.paginationLength,a=t.pagination,r=t.showPaginationLabel,s=t.originalColumns,o=t.originalPaginationLength,c=t.originalPagination,l=t.originalShowPaginationLabel;if(e.length){for(var h=window.innerWidth,u=!0,g=0;g<e.length;g++){var f=e[g],d=f.minWidth||0;if(f.maxWidth&&f.maxWidth>h&&d<h&&f.columns){f.columns&&(n=f.columns),f.paginationLength&&(i=f.paginationLength),void 0!==f.pagination&&(a=f.pagination),void 0!==f.showPaginationLabel&&(r=f.showPaginationLabel),u=!1;break}}u&&(n=assign({},s),i=clone(o),a=clone(c),r=clone(l)),this.config.columns=n,this.config.paginationLength=i,this.config.pagination=a,this.config.showPaginationLabel=r}}},{key:"generatePagination",value:function(){var i=this,t=this.config,n=t.data,e=t.pagination,a=t.nextText,r=t.prevText,s=t.paginationContainer,o=t.paginationLength,c=t.showPaginationLabel,l=$('<div class="btn-group"></div>'),h=[],u=n.length,g=0,f=$('<button class="btn btn-default prev">Prev</button>'),d=$('<button class="btn btn-default next">Next</button>'),p=$('<button class="btn btn-default" disabled="true">...</button>'),b=$('<button class="btn btn-default" disabled="true">...</button>');if(this.btnGroup&&this.btnGroup.remove(),e&&(!(u<this.rowsOnPage)||this.isPaginationGenerated)){for(a&&""!==a&&d.html(a),r&&""!==r&&f.html(r);0<u;){var v=$('<button class="btn"></button>');v.text(g+1),this.currentPage===g?v.addClass("btn-primary"):v.addClass("btn-default"),v.attr("data-to",g),h.push(v),u-=this.rowsOnPage,g+=1}if(l.append(f),h.length>o){var y=Math.floor(o/2);if(this.currentPage>y&&this.currentPage<h.length-y){var m=this.currentPage-y,P=this.currentPage+(o%2==0?y:y+1);l.append(h[0]),l.append(p),map(h.slice(m,P),function(t){return l.append(t),t}),l.append(b),l.append(h[h.length-1])}else if(this.currentPage<=y){var w=o;map(h.slice(0,w),function(t){return l.append(t),t}),l.append(b),l.append(h[h.length-1])}else if(this.currentPage>=h.length-y){var O=h.length-o,D=h.length;l.append(h[0]),l.append(p),map(h.slice(O,D),function(t,n){return l.append(t),t})}}else map(h,function(t,n){return l.append(t),t});if(l.append(d),l.click(function(t){if($(t.target).is(d))i.getPagesOffset(i.currentPage+1),i.constructTableCell(),i.generatePagination(),i.afterUpadte();else if($(t.target).is(f))i.getPagesOffset(i.currentPage-1),i.constructTableCell(),i.generatePagination(),i.afterUpadte();else for(var n=0;n<h.length;n++){var e=$(h[n]);$(t.target).is(e)&&(i.getPagesOffset(n),i.constructTableCell(),i.generatePagination(),i.afterUpadte())}}),0===this.currentPage&&f.attr("disabled",!0),this.currentPage===h.length-1&&d.attr("disabled",!0),this.btnGroup=l,this.controlRow){if(c){var C='<span class="page-label">Showing '+(this.leftBase+1)+" to "+this.rightBase+" of "+n.length+" entries</span>";this.controlLeftCol.html(C)}this.controlRightCol.html(this.btnGroup),s?$(s).html(this.controlRow):this.table.after(this.controlRow)}else s?$(s).html(this.btnGroup):this.table.after(this.btnGroup);this.isPaginationGenerated=!0}}},{key:"constructTableObject",value:function(){var t=this.config.element,n="";return $(t).is("table")?n=$(t):(n=$("<table></table>"),$(t).append(n)),n.addClass("gs-table"),n}},{key:"constructControlObject",value:function(){var t=$('<div class="row"></div>'),n=$('<div class="col-md-6"></div>'),e=$('<div class="col-md-6"></div>');e.css("text-align","right"),t.append(n).append(e),this.controlRow=t,this.controlLeftCol=n,this.controlRightCol=e}},{key:"constructTableCell",value:function(){var a=this,t=this.config,n=t.data,e=t.columns,r=t.sorting,s=t.processHtml,o=t.columnsHtml,c=t.sortingIcons;if(this.table.html(""),!n.length||isEmpty(e))return"";var l=$('<tbody class="gs-table-body-default"></tbody>'),i=$('<thead class="gs-table-head-default"></thead>'),h=$("<tr></tr>");forIn(e,function(t,n,e){var i=$("<th></th>");isFunction(o)?i.html(o(t,n,e)):i.html(t),i=a.addSorting(i,r,n,t,c),h.append(i)}),i.append(h),map(n.slice(this.leftBase,this.rightBase),function(i,t){var a=$("<tr></tr>");return forIn(e,function(t,n){if(void 0!==i[n]){var e=$("<td></td>");isFunction(s)?e.html(s(i,n,uniqueId(6))):e.html(i[n]),a.append(e)}}),l.append(a),n}),this.table.append(i),this.table.append(l)}},{key:"addSorting",value:function(t,n,e,i,a){if(!n||!i)return t;var r=this;return isArray(n)?-1!==n.indexOf(e)&&(e===r.sortingKey&&(r.sortDirection&&r.sortDirection!==sortDirection.ASC?t.append(a.dec):t.append(a.asc)),t.css("cursor","pointer"),t.click(function(){r.sortData(e)})):""!==i&&(e===r.sortingKey&&(r.sortDirection&&r.sortDirection!==sortDirection.ASC?t.append(a.dec):t.append(a.asc)),t.css("cursor","pointer"),t.click(function(){r.sortData(e)})),t}},{key:"onTableResize",value:function(){var t=this;$(window).on("resize",function(){t.prevScreenWidth!==window.innerWidth&&(t.getColumns(),t.update())})}},{key:"sortData",value:function(e){var t=this.config,n=t.data,i=t.dateParsing;this.sortingKey===e?this.sortDirection===sortDirection.ASC?(this.config.data=n.sort(function(t,n){if(i&&(-1!==e.toLowerCase().indexOf("date")||isDate(t[e])))return new Date(t[e])-new Date(n[e]);return t[e]<n[e]?-1:t[e]>n[e]?1:0}),this.sortDirection=sortDirection.DESC):this.sortDirection===sortDirection.DESC&&(this.config.data=reverse(n.sort(function(t,n){if(i&&(-1!==e.toLowerCase().indexOf("date")||isDate(t[e])))return new Date(t[e])-new Date(n[e]);return t[e]<n[e]?-1:t[e]>n[e]?1:0})),this.sortDirection=sortDirection.ASC):(this.config.data=n.sort(function(t,n){if(i&&(-1!==e.toLowerCase().indexOf("date")||isDate(t[e])))return new Date(t[e])-new Date(n[e]);return t[e]<n[e]?-1:t[e]>n[e]?1:0}),this.sortDirection=sortDirection.DESC),this.sortingKey=e,this.constructTableCell(),this.afterUpadte()}},{key:"searchText",value:function(a){var t=this.config,n=t.originalData,r=t.columns;return this.isUpdating=!0,this.config.data=a?filter(n.slice(),function(e){var i=!1;return forIn(r,function(t,n){-1!==String(e[n]).toLowerCase().indexOf(a.toLowerCase())&&(i=!0)}),i}):n.slice(),this.update()}},{key:"handleSearchField",value:function(){var n=this,t=this.config.searchField;t&&$(t).is("input")&&$(t).on("keyup",function(t){if(n.isUpdating)return!1;n.searchText(t.target.value)})}},{key:"update",value:function(){this.isDistroyed||(this.currentPage=0,this.getColumns(),this.getPagesOffset(this.currentPage),this.generatePagination(),this.constructTableCell(),this.afterUpadte(),this.isUpdating=!1)}},{key:"updateDataset",value:function(t){this.isDistroyed||(this.config.data=t,this.config.originalData=map(t,clone),this.update())}},{key:"distroy",value:function(){this.table&&this.table.remove(),this.btnGroup&&this.btnGroup.remove(),this.controlRow&&this.controlRow.remove(),this.isDistroyed=!0,this.afterDistroy()}},{key:"rebuild",value:function(t){this.isDistroyed&&(t&&(this.config=$.extend(defaultConfig,t)),this.sortingKey=null,this.sortDirection=null,this.currentPage=0,this.rowsOnPage=5,this.isUpdating=!1,this.prevScreenWidth=window.innerWidth,this.isPaginationGenerated=!1,this.isDistroyed=!1,this.table=this.constructTableObject(),this.getOriginalData(),this.getColumns(),this.getPagesOffset(this.currentPage),this.constructControlObject(),this.generatePagination(),this.constructTableCell(),this.handleSearchField(),this.onTableResize(),this.afterInit())}},{key:"afterInit",value:function(){this.config.events&&isFunction(this.config.events.onInit)&&this.config.events.onInit.call(this)}},{key:"afterUpadte",value:function(){this.config.events&&isFunction(this.config.events.onUpdate)&&this.config.events.onUpdate.call(this)}},{key:"afterDistroy",value:function(){this.config.events&&isFunction(this.config.events.onDistroy)&&this.config.events.onDistroy.call(this)}}]),n}();!function(t){if(!t)throw new Error("Table Sortable: jQuery is not defind.");t.fn.tableSortable=function(t){return t.element=this,new TableSortable(t)}}(jQuery);